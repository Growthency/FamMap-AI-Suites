<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Idea Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      body {
        font-family: "Inter", sans-serif;
        scroll-behavior: smooth;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }
      .loader {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .result-item {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
        animation: popIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      }
      @keyframes popIn {
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
    </style>
  </head>
  <body class="text-gray-800 antialiased bg-white">
    <!-- Header -->
    <header
      class="bg-white/80 backdrop-blur-xl sticky top-0 z-50 shadow-sm border-b border-gray-200/50"
    >
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <a
            href="https://fam-map-ai-suites.vercel.app/"
            class="flex items-center gap-2"
          >
            <img src="fam.png" alt="" class="famlogo" />
          </a>
          <div class="hidden md:flex items-center space-x-8">
            <a
              href="eventresearcher.html"
              class="text-gray-600 hover:text-indigo-600 font-medium transition-colors duration-300"
              >FamEvent</a
            >
            <a
              href="Short-Description.html"
              class="text-gray-600 hover:text-indigo-600 font-medium transition-colors duration-300"
              >FamiShort</a
            >
            <a
              href="universal.html"
              class="text-gray-600 hover:text-indigo-600 font-medium transition-colors duration-300"
              >FamUniversal</a
            >
            <a
              href="Ideagenerator.html"
              class="text-gray-600 hover:text-indigo-600 font-medium transition-colors duration-300"
              >FamIdea</a
            >
          </div>
          <div class="md:hidden">
            <button
              id="mobile-menu-button"
              class="text-gray-800 focus:outline-none"
            >
              <svg
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16m-7 6h7"
                />
              </svg>
            </button>
          </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden mt-4">
          <nav class="flex flex-col space-y-2">
            <a
              href="eventresearcher.html"
              class="text-gray-600 hover:bg-indigo-50 rounded-lg p-2 font-medium transition-colors duration-300"
              >FamEvent</a
            >
            <a
              href="Short-Description.html"
              class="text-gray-600 hover:bg-indigo-50 rounded-lg p-2 font-medium transition-colors duration-300"
              >FamiShort</a
            >
            <a
              href="universal.html"
              class="text-gray-600 hover:bg-indigo-50 rounded-lg p-2 font-medium transition-colors duration-300"
              >FamUniversal</a
            >
            <a
              href="Ideagenerator.html"
              class="text-gray-600 hover:bg-indigo-50 rounded-lg p-2 font-medium transition-colors duration-300"
              >FamIdea</a
            >
            >
          </nav>
        </div>
      </div>
    </header>
    <!-- Main Container -->
    <div
      class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl min-h-screen universalheigh"
    >
      <!-- Header -->
      <header class="text-center mb-10">
        <h1
          class="text-4xl sm:text-5xl font-bold text-gray-900 tracking-tight flex items-center justify-center gap-3"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-10 w-10 text-blue-500"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M10 2a1 1 0 011 1v1.333a1 1 0 01-2 0V3a1 1 0 011-1zm6.293 2.293a1 1 0 011.414 0l.001.001a1 1 0 010 1.414l-.943.943a1 1 0 01-1.414-1.414l.943-.943zM4.121 5.121a1 1 0 010-1.414l.943-.943a1 1 0 111.414 1.414l-.943.943a1 1 0 01-1.414 0zM10 18a1 1 0 01-1-1v-1.333a1 1 0 112 0V17a1 1 0 01-1 1zm-6.293-2.293a1 1 0 01-1.414 0l-.001-.001a1 1 0 010-1.414l.943-.943a1 1 0 111.414 1.414l-.943.943zM15.879 14.879a1 1 0 010 1.414l-.943.943a1 1 0 11-1.414-1.414l.943-.943a1 1 0 011.414 0zM18 10a1 1 0 01-1 1h-1.333a1 1 0 110-2H17a1 1 0 011 1zM4.333 9H3a1 1 0 100 2h1.333a1 1 0 100-2zM10 5a5 5 0 100 10 5 5 0 000-10z"
              clip-rule="evenodd"
            />
          </svg>
          Content Idea Generator
        </h1>
        <p class="text-gray-600 mt-3 text-lg">
          Skriv in ett nyckelord och få 10-15 unika innehållsidéer för familjer!
        </p>
      </header>

      <!-- Input Form Card -->
      <div
        class="bg-white/70 backdrop-blur-xl rounded-2xl shadow-lg p-6 sm:p-8 mb-8 sticky top-4 z-10 border border-white"
      >
        <form id="idea-form">
          <div class="flex flex-col sm:flex-row gap-4">
            <input
              type="text"
              id="keyword-input"
              name="keyword"
              placeholder="Ex: Halloween outfits"
              required
              class="flex-grow w-full px-5 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-sm text-lg bg-white/50"
            />
            <button
              type="submit"
              id="generate-btn"
              class="inline-flex items-center justify-center bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:scale-100 shadow-lg text-lg"
            >
              <span>Generera</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Output Section -->
      <div id="output-section" class="hidden">
        <!-- Loader -->
        <div
          id="loader"
          class="hidden flex flex-col justify-center items-center my-10 p-6 bg-white/70 backdrop-blur-xl border border-white rounded-2xl shadow-md"
        >
          <div class="loader"></div>
          <p
            id="loader-text"
            class="ml-4 text-gray-600 text-lg mt-4 text-center"
          >
            Tänker ut kreativa idéer... ett ögonblick...
          </p>
        </div>

        <!-- Error Message -->
        <div
          id="error-message"
          class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-md"
          role="alert"
        >
          <p class="font-bold">Ett fel uppstod</p>
          <p>
            Kunde inte generera idéer efter flera försök. Detta kan bero på ett
            tillfälligt nätverksproblem. Vänligen försök igen.
          </p>
        </div>

        <!-- Result Card -->
        <div
          id="result-card"
          class="hidden bg-white/70 backdrop-blur-xl border border-white rounded-2xl shadow-lg p-6 sm:p-8"
        >
          <h2
            class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6 border-b border-gray-200 pb-4"
          >
            Dina Innehållsidéer
          </h2>
          <ul id="ideas-list" class="space-y-4"></ul>
          <div class="mt-8 flex justify-end">
            <button
              id="copy-button"
              class="bg-green-500 text-white font-semibold py-2 px-5 rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105 shadow-md flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z"
                />
                <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
              </svg>
              <span>Kopiera Allt</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <footer class="text-center py-10 border-t bg-white">
      <div class="container mx-auto">
        <p class="text-gray-500">
          &copy; 2025 FamMap. Alla rättigheter förbehållna.
        </p>
      </div>
    </footer>
    <script>
      // --- DOM Elements ---
      const ideaForm = document.getElementById("idea-form");
      const generateBtn = document.getElementById("generate-btn");
      const outputSection = document.getElementById("output-section");
      const loader = document.getElementById("loader");
      const loaderText = document.getElementById("loader-text");
      const errorMessage = document.getElementById("error-message");
      const resultCard = document.getElementById("result-card");
      const ideasList = document.getElementById("ideas-list");
      const copyButton = document.getElementById("copy-button");

      // --- API Configuration ---
      const apiKeys = [
        "AIzaSyAFNA92_GhCkc8aOI-UAbteO50fW-ep55g",
        "AIzaSyAN_jn4dzxXNLbyAbJ2H9fyoqDkSpEei6o",
        "AIzaSyCc53TwSEIWQzUjATy-5lpXIGyZSM04tpI",
        "AIzaSyCfuY7h20oMxB2strUFKSoG_1-DlOsJcIs",
        "AIzaSyBYBDZpJbRGDuysRKSWB4IeH6rA5niwC7s",
      ];
      const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;

      // --- Event Listeners ---
      ideaForm.addEventListener("submit", handleFormSubmit);
      copyButton.addEventListener("click", copyToClipboard);

      // --- Main Functions ---
      async function handleFormSubmit(event) {
        event.preventDefault();
        const keyword = document.getElementById("keyword-input").value.trim();
        if (!keyword) return;

        setLoadingState(true);
        const updateStatus = (message) => {
          loaderText.textContent = message;
        };

        const schema = {
          type: "ARRAY",
          items: {
            type: "OBJECT",
            properties: { title: { type: "STRING" } },
            required: ["title"],
          },
        };

        const systemPrompt = `You are a parent who is also a world-class creative content strategist for "Fam Map," a Swedish app for families. Think from a parent's perspective: What would you genuinely want to read or do with your kids? Your SOLE TASK is to generate a list of 10-15 unique, creative, and highly engaging content ideas (as titles) based on a user's keyword.

  **CRITICAL STYLE & TONE GUIDE:**
            1.  **Language & Audience:** Must be in perfect, modern Swedish, speaking directly to other parents and families.
            2.  **Emotion & Vibe:** Titles must be engaging, authentic, and inspiring. Use emotional and sensory words (e.g., 'mysig', 'magisk', 'busenkla', 'doftande').
            3.  **Proven Formats:** Use popular, clickable title formats. Always aim for a helpful, inspiring, or fun angle.
            4.  **Specificity:** Provide concrete, 'doable' ideas. 'Förvandla en tråkig kartong till ett rymdskepp! 🚀' is much better than 'Bygg med kartonger'.
            5.  **Emojis:** End EVERY single title with a relevant and creative emoji. This is non-negotiable.
            6.  **Mandatory Numbered Lists:** At least 2-3 of the titles MUST be a numbered list format (e.g., "10 Roligaste...", "29 Busenkla..."). The number can be anything. For example: "29 gulliga Halloween-dräkter för din bebis första bus-eller-godis! 👶". This is a strict requirement.
            7.  **Inspirational Title Styles:** Your suggestions should include a mix of these proven styles:
                * **Question-Based:** e.g., "Är det säkert att äta [X] under graviditeten?"
                * **Problem-Solving / How-To:** e.g., "Hur du ändrar ditt barns sömnmönster – Steg för steg"
                * **Emotional Support:** e.g., "Hur du stöttar en vän som går igenom [svårighet]"
                * **Inspirational Lists:** e.g., "65 gulliga babynamn som börjar på R"

            **EXAMPLES - Follow this style:**
            * **BAD (Too boring):** "Gör julpynt"
            * **GOOD (Creative & Engaging):** "Från kotte till tomte: 5 magiska julpyssel barnen älskar! 🌲"
            * **BAD (Too generic):** "Tips för familjen"
            * **GOOD (Specific & Emotional):** "Skärmfri lördag: 7 mysiga lekar som samlar hela familjen! 🎲"

            **OUTPUT FORMAT:**
            You MUST return the output ONLY as a valid JSON array of objects. Each object must have a single key: "title". Do not include any other text, greetings, or explanations in your response.
            `;

        const userPrompt = `Keyword: "${keyword}"`;

        try {
          const jsonResponse = await callGeminiAPIWithRetries(
            systemPrompt,
            userPrompt,
            schema,
            updateStatus
          );
          const data = JSON.parse(jsonResponse);
          displayResults(data);
        } catch (error) {
          console.error("All API keys failed or returned invalid data:", error);
          displayError();
        } finally {
          setLoadingState(false);
        }
      }

      async function callGeminiAPIWithRetries(
        systemPrompt,
        userPrompt,
        schema,
        updateStatusCallback,
        keyIndex = 0
      ) {
        if (keyIndex >= apiKeys.length) {
          throw new Error("All API keys failed.");
        }

        const apiKey = apiKeys[keyIndex];
        const apiUrl = apiUrlBase + apiKey;
        const attempt = keyIndex + 1;

        if (updateStatusCallback)
          updateStatusCallback(
            `Tänker ut kreativa idéer... (Försök ${attempt}/${apiKeys.length})`
          );

        const payload = {
          contents: [{ parts: [{ text: userPrompt }] }],
          systemInstruction: { parts: [{ text: systemPrompt }] },
          generationConfig: {
            responseMimeType: "application/json",
            responseSchema: schema,
            temperature: 0.8,
          },
        };

        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok)
            throw new Error(`API call failed with status: ${response.status}`);

          const result = await response.json();

          if (
            result.candidates &&
            result.candidates.length > 0 &&
            result.candidates[0].content &&
            result.candidates[0].content.parts[0].text
          ) {
            // Final validation check to ensure it's a non-empty array of objects with titles.
            const data = JSON.parse(result.candidates[0].content.parts[0].text);
            if (Array.isArray(data) && data.length > 0 && data[0].title) {
              return result.candidates[0].content.parts[0].text;
            }
          }
          throw new Error("API returned invalid or empty data.");
        } catch (error) {
          console.warn(`Attempt ${attempt} failed:`, error.message);
          await new Promise((resolve) => setTimeout(resolve, 1500));
          return await callGeminiAPIWithRetries(
            systemPrompt,
            userPrompt,
            schema,
            updateStatusCallback,
            keyIndex + 1
          );
        }
      }

      // --- UI Helper Functions ---
      function displayResults(data) {
        ideasList.innerHTML = "";
        data.forEach((item, index) => {
          const li = document.createElement("li");
          li.className =
            "flex items-center text-gray-800 bg-white/60 p-4 rounded-xl border border-white shadow-sm result-item hover:shadow-md transition-shadow duration-300";
          li.style.animationDelay = `${index * 60}ms`;

          const numberDiv = document.createElement("div");
          numberDiv.className =
            "mr-4 text-blue-600 font-bold text-lg flex-shrink-0 bg-blue-100 rounded-full h-8 w-8 flex items-center justify-center";
          numberDiv.textContent = `${index + 1}`;

          const textSpan = document.createElement("span");
          textSpan.textContent = item.title;
          textSpan.className = "break-words leading-snug";

          li.appendChild(numberDiv);
          li.appendChild(textSpan);
          ideasList.appendChild(li);
        });
        resultCard.classList.remove("hidden");
        resultCard.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function copyToClipboard() {
        const items = Array.from(ideasList.querySelectorAll("li"));
        const textToCopy = items
          .map(
            (li, index) =>
              `${index + 1}. ${li.querySelector("span").textContent}`
          )
          .join("\n");

        navigator.clipboard
          .writeText(textToCopy)
          .then(() => {
            copyButton.querySelector("span").textContent = "Kopierad!";
            setTimeout(() => {
              copyButton.querySelector("span").textContent = "Kopiera Allt";
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
              document.execCommand("copy");
              copyButton.querySelector("span").textContent = "Kopierad!";
              setTimeout(() => {
                copyButton.querySelector("span").textContent = "Kopiera Allt";
              }, 2000);
            } catch (err) {
              console.error("Fallback copy failed", err);
            }
            document.body.removeChild(textArea);
          });
      }

      function displayError() {
        errorMessage.classList.remove("hidden");
        errorMessage.scrollIntoView({ behavior: "smooth", block: "center" });
      }

      function setLoadingState(isLoading) {
        outputSection.classList.remove("hidden");
        if (isLoading) {
          loaderText.textContent =
            "Tänker ut kreativa idéer... ett ögonblick...";
          loader.classList.remove("hidden");
          resultCard.classList.add("hidden");
          errorMessage.classList.add("hidden");
          generateBtn.disabled = true;
          generateBtn.querySelector("span").textContent = "Genererar...";
        } else {
          loader.classList.add("hidden");
          generateBtn.disabled = false;
          generateBtn.querySelector("span").textContent = "Generera Idéer";
        }
      }
    </script>
  </body>
</html>
